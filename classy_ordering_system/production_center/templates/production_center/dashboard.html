{% extends 'production-app-layout.html' %}
{% load static%}
{% block option_title %} Production Center Dashboard
 {% endblock %}
{% block navbartitle %} Production Center Dashboard
{% endblock %}

{% block content %}
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">

    <!--end::Breadcrumb-->

    <!--begin::Post-->
    <div class="post d-flex flex-column-fluid" id="kt_post">
        <!--begin::Container-->
        <div id="kt_content_container" class="container">
            <!--begin::Row-->
            <div class="row" >
                <div class="col-xl-6">
                </div>
            <div class="col-xl-6">
            <div class="mb-4 text-end">
                <a href="{% url 'production_center:production-dashboard' %}">
                    <button type="button" class="btn btn-secondary" >
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"></path>
                        <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"></path>
                        </svg>
                    </button>
                </a>
                <button id="received_order_button" type="button" class="btn btn-primary" >submit </button>
            </div>
        </div>
        </div><!-- end  row -->
            <div class="row">
                <div class="col-xl-6">
                    <div class="card mb-6">
                        <div class="card-header border-0 pt-5 ">
                            <h3 class="card-title align-items-start flex-column">
                                <span class="card-label fw-bolder fs-3 mb-1">Received Order</span>                                                
                            </h3>
                        </div>
                            <div class="ms-auto col-md-7 mt-4  d-flex align-items-center">
                                <label class="fs-5 fw-bold me-2 ">Search </label>
                                <input id="recived_orders_search" type="text" class="form-control form-control-solid" placeholder="Search here... " />
                                <button type="button" class="btn btn-secondary" id="recived_orders_search_button">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                      </svg>
                                </button>
                                
                            </div>
                            <div class="text-end mb-3">
                                <i class="small">Search by Client name, Client ID or job ID</i>
                            </div>
                            <!--begin::Table-->
                            <div id='recived_list'>
                            <div class="table-responsive">
                                <table class="table align-middle table-bordered table-alternet tbl-white fs-6 gy-5  ">
                                    <thead>
                                        <tr class="text-start fw-bolder fs-7 text-uppercase gs-0">
                                            <th class="w-10px pe-2"></th>
                                            <th class="min-w-125px">Job ID</th>
                                            <th class="min-w-125px">Job Sub ID</th>
                                            <th class="min-w-125px">Client ID</th>
                                            <th class="min-w-125px">Client Name</th>
                                        </tr>
                                    </thead>
                                    <!--begin::Table body-->
                                    <tbody class="text-gray-600 fw-bold">
                                        <!--begin::Table row-->
                                        {% for order in received_orders  %}
                                        <tr>
                                            <!--begin::Checkbox-->
                                            <td>
                                                <div class="form-check form-check-sm form-check-custom form-check-solid">
                                                    <input class="form-check-input inprogress_orders jId-select " type="checkbox" value="{{order.id}}"  name="job-client-ID_check" />
                                                </div>
                                            </td>
                                            <!--end::Checkbox-->
                                            <td>
                                                <span class="job-ID"> {{order.job.job_id}}</span>
                                            </td>
                                            <td><span class="job_status_id">{{order.job_status_id}}</span></td>
                                            <td><span class="client-ID">{{order.job.client_id}}</span></td>
                                            <td>{{order.job.client_name}}</td>
                                        </tr>
                                    
                                        {% endfor %}
    
                                    </tbody>
                                    <!--end::Table body-->
                                </table>
                            </div>
                        </div>
                        
                        <!--end::Card body-->
                    </div>
                    <!--end::Card-->                   
                </div>
                <div class="col-xl-6">
                    <div class="card mb-6">
                        <div class="card-header border-0 pt-5">
                            <h3 class="card-title align-items-start flex-column">
                                <span class="card-label fw-bolder fs-3 mb-1">Completed Order </span>                                                
                            </h3>
                            <!-- <button id="completed_orders_button" type="button" class="btn btn-primary" >submit </button>  -->

                        </div>
                        
                           
                            <div class="ms-auto col-md-7 mt-4  d-flex align-items-center">
                                <label class="fs-5 fw-bold me-2 ">Search </label>
                                <input id="completed_orders_search" type="text" class="form-control form-control-solid" placeholder="Search here... " />
                                <button type="button" class="btn btn-secondary" id="completed_orders_search_button">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                      </svg>
                                </button>
                                
                            </div>
                            <div class="text-end mb-3">
                                <i class="small">Search by Client name, Client ID or job ID</i>
                            </div>
                            <!--begin::Table-->
                            <div id='completed_list'>
                            <div class="table-responsive">
                                <table class="table align-middle table-bordered table-alternet table-alternet-red table fs-6 gy-5">
                                    <thead>
                                        <tr class="text-start fw-bolder fs-7 text-uppercase gs-0">
                                            <th class="w-10px pe-2"></th>
                                            <th class="min-w-125px">Job ID</th>
                                            <th class="min-w-125px">Job Sub ID</th>
                                            <th class="min-w-125px">Client ID</th>
                                            <th class="min-w-125px">Client Name</th>
                                        </tr>
                                    </thead>
                                    <!--begin::Table body-->
                                    <tbody class="text-gray-600 fw-bold">
                                        <!--begin::Table row-->
                                        {% for order in completed_orders  %}
                                        <tr>
                                            <!--begin::Checkbox-->
                                            <td>
                                                <div class="form-check form-check-sm form-check-custom form-check-solid">
                                                    <input class="form-check-input inprogress_orders jId-select " type="checkbox" value="{{order.id}}"  name="job-client-ID_check" />
                                                </div>
                                            </td>
                                            <!--end::Checkbox-->
                                            <td>
                                                <span class="job-ID"> {{order.job.job_id}}</span>
                                            </td>
                                            <td><span class="job_status_id">{{order.job_status_id}}</span></td>
                                            <td><span class="client-ID">{{order.job.client_id}}</span></td>
                                            <td>{{order.job.client_name}}</td>
                                        </tr>
                                    
                                        {% endfor %}
    
                                    </tbody>
                                    <!--end::Table body-->
                                </table>
                            </div>
                        </div>
                        
                        <!--end::Card body-->
                    </div>
                    <!--end::Card-->                   
                </div>
            </div>
            <!--end::Row-->
          
        </div>
        <!--end::Container-->
    </div>
    <!--end::Post-->
</div>
{% endblock %}



{% block extra_scripts %}
<script>
loadAvailableOrders=(url,searchID,type,divID,page)=>{
    $.ajax({                       
            url: url,                  
            data: {
                'search_id':searchID,'type':type,'page':page
            },
            success: function (data) { 
                
                $("#"+divID).html(data).trigger('change');                
            }
        });
}
$(document).find('#recived_orders_search_button').on('click',function(e) {
    searchID= $('#recived_orders_search').val()
           url="{% url 'production_center:order-search' %}"
           loadAvailableOrders(url,searchID,'received','recived_list','RECIVED_ORDER')
 });
 $(document).find('#completed_orders_search_button').on('click',function(e) {
    searchID= $('#completed_orders_search').val()
            url="{% url 'production_center:order-search' %}"
           loadAvailableOrders(url,searchID,'completed','completed_list','COMPLETED_ORDER')
 });
 $("#completed_orders_search").keydown(function (e) {
  if (e.keyCode == 13) {
    $(document).find('#completed_orders_search_button').trigger('click')
  }
})
$("#recived_orders_search").keydown(function (e) {
  if (e.keyCode == 13) {
    $(document).find('#recived_orders_search_button').trigger('click')
  }
})


 var job_id;
 var job_status_id;
 var job_list=[];
 var job_sub_ids=[];
 $(document).on("change", ".jId-select", function (e) {
     
  job_id = $(this).parents("tr").find(".job-ID").text();
  job_status_id = $(this).parents("tr").find(".job_status_id").text();
  if(! job_list.includes(job_id)){
    job_list=[];
    job_sub_ids=[];
    job_list.push(job_id)  
    job_sub_ids.push(job_status_id)
    $('.jId-select').prop('checked', false);
    $(this).prop('checked', true);     
  }
  else{
    job_list.push(job_id)
    job_sub_ids.push(job_status_id)
  }
 })

$("#completed_orders_button,#received_order_button").on("click",function (){
    if (job_id &&job_status_id){
    window.location.href="/classy/production/orders/"+parseInt(job_id)+"/?job_sub_ids="+job_sub_ids
    }
})
 </script>
{% endblock %}